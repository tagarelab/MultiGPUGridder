<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Multi-GPU Gridding: Matlab/MultiGPUGridder_Matlab_Class.m Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Multi-GPU Gridding
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_092fa114fb57194ecc57c00285846686.html">Matlab</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">MultiGPUGridder_Matlab_Class.m</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_multi_g_p_u_gridder___matlab___class_8m.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;%MultiGPUGridder_Matlab_Class Example MATLAB <span class="keyword">class </span>wrapper to an underlying C++ class</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;classdef MultiGPUGridder_Matlab_Class &lt; handle</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    properties (SetAccess = public, Hidden = false)</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;        </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;        <a class="code" href="mex__interface_8m.html#a0a92e8b98c2f8014ac8376d6c7510de8">objectHandle</a>; % Handle to the underlying C++ class instance</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;        </div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;        % Flag to run the forward / inverse FFT <a class="code" href="create__uniform__axes_8m.html#a58ab1fd68e97078232808206b850161b">on</a> the device (<a class="code" href="_timing_test_script_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>.e. the GPU)</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;        <a class="code" href="_timing_test_script_8m.html#ada8a976a34768237a2ce9b4c08e67608">RunFFTOnGPU</a> = true;        </div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;        </div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;        % Flag <span class="keywordflow">for</span> status output to the console</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;        verbose = <span class="keyword">false</span>;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;        </div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;        % Int 32 type variables        </div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;        VolumeSize;        </div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;        NumAxes;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;        GPUs = int32([]);</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;        MaxAxesToAllocate;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;        <a class="code" href="_multi_gridder_timing_test_8m.html#ab5d4acec05460ab2d7535031e3ebeef0">nStreamsFP</a>;% For the forward projection</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;        <a class="code" href="_multi_gridder_timing_test_8m.html#a371ef7d7d88e2475119f3b6d37596903">nStreamsBP</a>; % For the back projection</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;        </div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;        % Single type variables        </div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;        <a class="code" href="_timing_test_script_8m.html#a3eeac03a9d930969ad2e15361676577b">interpFactor</a>;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;        kerHWidth = 2;        </div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;        kerTblSize = 501;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;        extraPadding = 3;    </div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;        KBTable;        </div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;        <a class="code" href="_multi_gridder_timing_test_8m.html#afeee088a42e300511137ea0a19154d47">coordAxes</a>;      </div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;        <a class="code" href="_c_a_s_to_complex_test_8m.html#ab14ce89a06368a3ce058dbccb2ce3076">CASVolume</a>;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;        CASImages;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;        <a class="code" href="_c_a_s_to_complex_test_8m.html#a6d9118f5c2ef537242b2308e1dad42f7">Volume</a>;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;        Images;  </div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;        MaskRadius;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        </div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <a class="code" href="grid_lib_kaiser_8m.html#afb358f48b1646c750fb9da6c6585be2b">end</a></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    </div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    methods</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        %% Constructor - Create <a class="code" href="get__axes__from__n__rot_8m.html#a74946d12fa08ad0e91b5f5dde42e4d5b">a</a> new C++ class instance </div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        <a class="code" href="get_sizes_8m.html#af5c17788289fd88c5ce8d031980f35c4">function</a> this = MultiGPUGridder_Matlab_Class(varargin)  </div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;           </div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;            <a class="code" href="_run___unit___tests_8m.html#a0e75aa0c65fdb207c8e25c26f2d0c447">p</a> = inputParser;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;            addOptional(<a class="code" href="_run___unit___tests_8m.html#a0e75aa0c65fdb207c8e25c26f2d0c447">p</a>, <span class="stringliteral">&#39;VolumeSize&#39;</span>, 0, @isnumeric);</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;            addOptional(<a class="code" href="_run___unit___tests_8m.html#a0e75aa0c65fdb207c8e25c26f2d0c447">p</a>, <span class="stringliteral">&#39;NumAxes&#39;</span>, 0, @isnumeric);</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;            addOptional(<a class="code" href="_run___unit___tests_8m.html#a0e75aa0c65fdb207c8e25c26f2d0c447">p</a>, <span class="stringliteral">&#39;interpFactor&#39;</span>, 2, @isnumeric);</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;            addOptional(<a class="code" href="_run___unit___tests_8m.html#a0e75aa0c65fdb207c8e25c26f2d0c447">p</a>, <span class="stringliteral">&#39;GPUs&#39;</span>, [], @isnumeric);</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;            addOptional(<a class="code" href="_run___unit___tests_8m.html#a0e75aa0c65fdb207c8e25c26f2d0c447">p</a>, <span class="stringliteral">&#39;RunFFTOnGPU&#39;</span>, 1, @isnumeric); % Offset of the ProjNdx <a class="code" href="get_kernel_filt_table_8m.html#a6784e1c334dfceb8f017667c0b0f6a3e">index</a> (<span class="keywordflow">if</span> we want to project <a class="code" href="get__axes__from__n__rot_8m.html#a74946d12fa08ad0e91b5f5dde42e4d5b">a</a> subset of the <a class="code" href="_multi_gridder_timing_test_8m.html#a897b5234b10d5d8e7c453b6f5f76f884">images</a>)</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;            addOptional(<a class="code" href="_run___unit___tests_8m.html#a0e75aa0c65fdb207c8e25c26f2d0c447">p</a>, <span class="stringliteral">&#39;verbose&#39;</span>, 0, @isnumeric);</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;            addOptional(<a class="code" href="_run___unit___tests_8m.html#a0e75aa0c65fdb207c8e25c26f2d0c447">p</a>, <span class="stringliteral">&#39;nStreamsFP&#39;</span>, 10, @isnumeric);</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;            addOptional(<a class="code" href="_run___unit___tests_8m.html#a0e75aa0c65fdb207c8e25c26f2d0c447">p</a>, <span class="stringliteral">&#39;nStreamsBP&#39;</span>, 4, @isnumeric);</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;            addOptional(<a class="code" href="_run___unit___tests_8m.html#a0e75aa0c65fdb207c8e25c26f2d0c447">p</a>, <span class="stringliteral">&#39;MaxAxesToAllocate&#39;</span>, 1000, @isnumeric);</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;            </div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;            parse(<a class="code" href="_run___unit___tests_8m.html#a0e75aa0c65fdb207c8e25c26f2d0c447">p</a>, varargin{:});</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;            this.VolumeSize = int32(<a class="code" href="_run___unit___tests_8m.html#a0e75aa0c65fdb207c8e25c26f2d0c447">p</a>.Results.VolumeSize);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;            this.NumAxes = int32(<a class="code" href="_run___unit___tests_8m.html#a0e75aa0c65fdb207c8e25c26f2d0c447">p</a>.Results.NumAxes);</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;            this.<a class="code" href="_timing_test_script_8m.html#a3eeac03a9d930969ad2e15361676577b">interpFactor</a> = single(<a class="code" href="_run___unit___tests_8m.html#a0e75aa0c65fdb207c8e25c26f2d0c447">p</a>.Results.interpFactor);</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;            this.GPUs = <a class="code" href="_run___unit___tests_8m.html#a0e75aa0c65fdb207c8e25c26f2d0c447">p</a>.Results.GPUs;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;            this.<a class="code" href="_timing_test_script_8m.html#ada8a976a34768237a2ce9b4c08e67608">RunFFTOnGPU</a> = int32(<a class="code" href="_run___unit___tests_8m.html#a0e75aa0c65fdb207c8e25c26f2d0c447">p</a>.Results.RunFFTOnGPU);</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;            this.verbose = <a class="code" href="_run___unit___tests_8m.html#a0e75aa0c65fdb207c8e25c26f2d0c447">p</a>.Results.verbose;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;            this.<a class="code" href="_multi_gridder_timing_test_8m.html#ab5d4acec05460ab2d7535031e3ebeef0">nStreamsFP</a> = <a class="code" href="_run___unit___tests_8m.html#a0e75aa0c65fdb207c8e25c26f2d0c447">p</a>.Results.nStreamsFP;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;            this.<a class="code" href="_multi_gridder_timing_test_8m.html#a371ef7d7d88e2475119f3b6d37596903">nStreamsBP</a> = <a class="code" href="_run___unit___tests_8m.html#a0e75aa0c65fdb207c8e25c26f2d0c447">p</a>.Results.nStreamsBP;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;            this.MaxAxesToAllocate = <a class="code" href="_run___unit___tests_8m.html#a0e75aa0c65fdb207c8e25c26f2d0c447">p</a>.Results.MaxAxesToAllocate;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;            <span class="keywordflow">if</span> (this.VolumeSize == 0)</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;                error(<span class="stringliteral">&quot;VolumeSize is a required input.&quot;</span>)</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;            elseif (this.NumAxes == 0)</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                error(&quot;NumAxes is <a class="code" href="get__axes__from__n__rot_8m.html#a74946d12fa08ad0e91b5f5dde42e4d5b">a</a> required input.&quot;)</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;            <a class="code" href="grid_lib_kaiser_8m.html#afb358f48b1646c750fb9da6c6585be2b">end</a></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;            </div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;            % Create the <a class="code" href="_c_a_s_to_complex_test_8m.html#a6d9118f5c2ef537242b2308e1dad42f7">Volume</a> array</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;            this.<a class="code" href="_c_a_s_to_complex_test_8m.html#a6d9118f5c2ef537242b2308e1dad42f7">Volume</a> = zeros(repmat(this.VolumeSize, 1, 3), &#39;single&#39;);</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                        </div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;            % If the GPUs to use was not given use all the <a class="code" href="vol_from_c_a_s___gridder_8m.html#a624b48103a930ce475060f7d7040d128">available</a> GPUs</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;            <a class="code" href="get__axes__from__n__rot_8m.html#a98431243eb755eab1bb1b077ce199d22">if</a> isempty(this.GPUs)</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                this.GPUs = int32([1:gpuDeviceCount]) - 1; % CUDA GPU device numbers need to <a class="code" href="_matlab_example_8m.html#aa281e9bfb864b5206b9f3c2ae14cc203">start</a> at zero</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;            <a class="code" href="grid_lib_kaiser_8m.html#afb358f48b1646c750fb9da6c6585be2b">end</a>            </div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;            </div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;            % Reset all the GPU devices</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;            for <a class="code" href="_timing_test_script_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 1:length(this.GPUs)</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                <a class="code" href="get__axes__from__n__rot_8m.html#a98431243eb755eab1bb1b077ce199d22">if</a> this.verbose == true</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;                    disp(&quot;Resetting GPU number &quot;  + num2str(<span class="keywordtype">double</span>(this.GPUs(<a class="code" href="_timing_test_script_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>) + 1)))</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;                <a class="code" href="grid_lib_kaiser_8m.html#afb358f48b1646c750fb9da6c6585be2b">end</a></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                <a class="code" href="_add_volume_test_8m.html#a48812c06132551c8490cfe6d127d1f12">reset</a>(gpuDevice(<span class="keywordtype">double</span>(this.GPUs(<a class="code" href="_timing_test_script_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>) + 1)));</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;            <a class="code" href="grid_lib_kaiser_8m.html#afb358f48b1646c750fb9da6c6585be2b">end</a></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                </div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;            this.MaskRadius = (single(this.VolumeSize) * this.<a class="code" href="_timing_test_script_8m.html#a3eeac03a9d930969ad2e15361676577b">interpFactor</a>) / 2 - 1;            </div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;            gridder_Varargin = cell(8,1);</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;            gridder_Varargin{1} = int32(this.VolumeSize);</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;            gridder_Varargin{2} = int32(this.NumAxes);</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;            gridder_Varargin{3} = single(this.<a class="code" href="_timing_test_script_8m.html#a3eeac03a9d930969ad2e15361676577b">interpFactor</a>);</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;            gridder_Varargin{4} = int32(this.extraPadding);            </div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;            gridder_Varargin{5} = int32(length(this.GPUs));</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            gridder_Varargin{6} = int32(this.GPUs);</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;            gridder_Varargin{7} = int32(this.<a class="code" href="_timing_test_script_8m.html#ada8a976a34768237a2ce9b4c08e67608">RunFFTOnGPU</a>);</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;            gridder_Varargin{8} = this.verbose;            </div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;            </div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;            % Check that the GPU <a class="code" href="get_kernel_filt_table_8m.html#a6784e1c334dfceb8f017667c0b0f6a3e">index</a> vector is valid given the number of <a class="code" href="vol_from_c_a_s___gridder_8m.html#a624b48103a930ce475060f7d7040d128">available</a> GPUs <a class="code" href="create__uniform__axes_8m.html#a58ab1fd68e97078232808206b850161b">on</a> the computer</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;            <span class="keywordflow">if</span> length(this.GPUs) &gt; gpuDeviceCount</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                error(<span class="stringliteral">&quot;Requested more GPUs than are available. Please change the GPUs vector in MultiGPUGridder class.&quot;</span>)</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;            elseif max(this.GPUs(:)) - 1 &gt; gpuDeviceCount</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                error(&quot;GPU <a class="code" href="get_kernel_filt_table_8m.html#a6784e1c334dfceb8f017667c0b0f6a3e">index</a> must range from 0 to the number of <a class="code" href="vol_from_c_a_s___gridder_8m.html#a624b48103a930ce475060f7d7040d128">available</a> GPUs. Please change the GPUs vector in <a class="code" href="class_multi_g_p_u_gridder.html">MultiGPUGridder</a> class.&quot;)</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;            <a class="code" href="grid_lib_kaiser_8m.html#afb358f48b1646c750fb9da6c6585be2b">end</a></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;            % Create the <a class="code" href="_multi_gridder_timing_test_8m.html#adf4d1866ff60e0a0d4a179ec724bc792">gridder</a> instance</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;            this.<a class="code" href="mex__interface_8m.html#a0a92e8b98c2f8014ac8376d6c7510de8">objectHandle</a> = mexCreateGridder(gridder_Varargin{1:8});           </div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                       </div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            % Initialize the output projection <a class="code" href="_multi_gridder_timing_test_8m.html#a897b5234b10d5d8e7c453b6f5f76f884">images</a> array</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            ImageSize = [this.VolumeSize, this.VolumeSize, this.NumAxes];</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;            this.Images = zeros(ImageSize(1), ImageSize(2), ImageSize(3), <span class="stringliteral">&#39;single&#39;</span>);          </div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;            % Load the Kaiser Bessel lookup table</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;            this.KBTable = single(getKernelFiltTable(this.kerHWidth, this.kerTblSize));            </div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        </div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            % If we<span class="stringliteral">&#39;re running the FFTs on the CPU, allocate the CPU memory to return the arrays to</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="stringliteral">            if (this.RunFFTOnGPU == false) || this.verbose == true</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="stringliteral">                % Create the CASImages array</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="stringliteral">                CASImagesSize = size(this.Volume, 1) * this.interpFactor; </span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="stringliteral">                this.CASImages = zeros([CASImagesSize, CASImagesSize, this.NumAxes], &#39;</span>single<span class="stringliteral">&#39;);  </span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="stringliteral">                </span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="stringliteral">            end            </span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="stringliteral">            </span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="stringliteral">            % Create the CASVolume array</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="stringliteral">            this.CASVolume = zeros(repmat(size(this.Volume, 1) * this.interpFactor + this.extraPadding * 2, 1, 3), &#39;</span>single<span class="stringliteral">&#39;);                  </span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="stringliteral">            % Create the coordinate axes array</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="stringliteral">            this.coordAxes = zeros(9, this.NumAxes, &#39;</span>single<span class="stringliteral">&#39;);</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="stringliteral">            </span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="stringliteral">            % Set the matlab array pointers to the C++ class</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="stringliteral">            % NOTE: Ensure that the pointers are not overwritten anywhere in the Matlab class</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="stringliteral">            % it is possible to call Set() again to re-copy the pointers, but this is not as reliable</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="stringliteral">            this.Set();</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="stringliteral">        end        </span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="stringliteral">        %% Deconstructor - Delete the C++ class instance </span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="stringliteral">        function delete(this)</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="stringliteral">            mexDeleteGridder(this.objectHandle);</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="stringliteral">        end  </span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="stringliteral">        %% SetVariables - Set the variables of the C++ class instance </span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="stringliteral">        function Set(this)</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="stringliteral">            </span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="stringliteral">            if (isempty(this.coordAxes) || isempty(this.Volume) || isempty(this.Images) ...</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="stringliteral">                || isempty(this.GPUs) || isempty(this.KBTable) || isempty(this.nStreamsFP) || isempty(this.nStreamsBP))</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="stringliteral">                error(&quot;Error: Required array is missing in Set() function.&quot;)             </span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="stringliteral">            end              </span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="stringliteral">            </span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="stringliteral">            % Check the sizes of the input variables</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="stringliteral">            if unique(size(this.Volume)) ~= size(this.Volume,1)</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="stringliteral">                error(&quot;Volume must be a square&quot;)</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="stringliteral">            elseif unique(size(this.Images(:,:,1))) ~= size(this.Images(:,:,1),1)</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="stringliteral">                error(&quot;Images must be a square&quot;)</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="stringliteral">            elseif size(this.Images(:,:,1),1) ~= size(this.Volume,1)</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="stringliteral">                error(&quot;Images must be the same size as Volume&quot;)</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="stringliteral">            elseif size(this.Images(:,:,1),1) &lt;= this.MaskRadius</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="stringliteral">%                 error(&quot;Images must be larger than the MaskRadius&quot;)</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="stringliteral">            elseif size(this.Volume,1) &lt;= this.MaskRadius</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="stringliteral">                error(&quot;Volume must be larger than the MaskRadius&quot;)</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="stringliteral">            end</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="stringliteral">            </span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="stringliteral">            this.CheckParameters();</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="stringliteral">            </span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="stringliteral">            [varargout{1:nargout}] = mexSetVariables(&#39;</span>SetCoordAxes<span class="stringliteral">&#39;, this.objectHandle, single(this.coordAxes(:)), int32(size(this.coordAxes(:))));</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="stringliteral">            [varargout{1:nargout}] = mexSetVariables(&#39;</span>SetVolume<span class="stringliteral">&#39;, this.objectHandle, single(this.Volume), int32(size(this.Volume)));                                 </span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="stringliteral">            [varargout{1:nargout}] = mexSetVariables(&#39;</span>SetImages<span class="stringliteral">&#39;, this.objectHandle, single(this.Images), int32(size(this.Images)));            </span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="stringliteral">            [varargout{1:nargout}] = mexSetVariables(&#39;</span>SetGPUs<span class="stringliteral">&#39;, this.objectHandle, int32(this.GPUs), int32(length(this.GPUs)));</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="stringliteral">            [varargout{1:nargout}] = mexSetVariables(&#39;</span>SetKBTable<span class="stringliteral">&#39;, this.objectHandle, single(this.KBTable), int32(size(this.KBTable)));           </span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="stringliteral">            [varargout{1:nargout}] = mexSetVariables(&#39;</span>SetNumberStreamsFP<span class="stringliteral">&#39;, this.objectHandle, int32(this.nStreamsFP));             </span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="stringliteral">            [varargout{1:nargout}] = mexSetVariables(&#39;</span>SetNumberStreamsBP<span class="stringliteral">&#39;, this.objectHandle, int32(this.nStreamsBP));</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="stringliteral">            [varargout{1:nargout}] = mexSetVariables(&#39;</span>SetMaskRadius<span class="stringliteral">&#39;, this.objectHandle, single(this.MaskRadius));</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="stringliteral">            [varargout{1:nargout}] = mexSetVariables(&#39;</span>SetNumAxes<span class="stringliteral">&#39;, this.objectHandle, int32(size(this.coordAxes,2))); </span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="stringliteral">            [varargout{1:nargout}] = mexSetVariables(&#39;</span>SetCASVolume<span class="stringliteral">&#39;, this.objectHandle, single(this.CASVolume), int32(size(this.CASVolume)));</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="stringliteral">            if ~isempty(this.CASImages)</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="stringliteral">                [varargout{1:nargout}] = mexSetVariables(&#39;</span>SetCASImages<span class="stringliteral">&#39;, this.objectHandle, single(this.CASImages), int32(size(this.CASImages)));</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="stringliteral">            end</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="stringliteral">            if ~isempty(this.MaxAxesToAllocate)</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="stringliteral">                [varargout{1:nargout}] = mexSetVariables(&#39;</span>SetMaxAxesToAllocate<span class="stringliteral">&#39;, this.objectHandle, int32(this.MaxAxesToAllocate));</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="stringliteral">            end            </span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="stringliteral">            </span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="stringliteral">        end </span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="stringliteral">        %% ForwardProject - Run the forward projection function</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="stringliteral">        function ProjectionImages = forwardProject(this, varargin)</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="stringliteral">            if ~isempty(varargin)</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="stringliteral">                </span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="stringliteral">                if length(varargin) == 1</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="stringliteral">                    % A new set of coordinate axes was passed</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="stringliteral">                    % (:,1:size(single(varargin{1}),2))</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="stringliteral">                    numAxes = size(single(varargin{1}),2);</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="stringliteral">                    this.coordAxes(:,1:numAxes) = single(varargin{1});        </span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="stringliteral">                    mexSetVariables(&#39;</span>SetNumAxes<span class="stringliteral">&#39;, this.objectHandle, int32(numAxes)); </span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="stringliteral">                       </span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="stringliteral">                elseif length(varargin) == 3</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="stringliteral">                    % Varargin 1: Mean volume</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="stringliteral">                    % Varargin 2: Coordinate axes</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="stringliteral">                    % Varargin 3: Mask radius</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="stringliteral">                    this.Volume = single(varargin{1});</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="stringliteral">                    numAxes = size(single(varargin{2}),2);</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="stringliteral">                    this.coordAxes(:,1:numAxes) = single(varargin{2});        </span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="stringliteral">                    mexSetVariables(&#39;</span>SetNumAxes<span class="stringliteral">&#39;, this.objectHandle, int32(numAxes)); </span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="stringliteral">                    </span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="stringliteral">                    this.MaskRadius = single(varargin{3});                    </span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="stringliteral">                else</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="stringliteral">                    disp(&#39;</span>forwardProject(): Unknown input<span class="stringliteral">&#39;)</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="stringliteral">                    return</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="stringliteral">                end</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="stringliteral">            end</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="stringliteral">            </span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="stringliteral">            [origBox,interpBox,CASBox]=getSizes(single(this.VolumeSize), this.interpFactor,3);</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="stringliteral">            temp = CASFromVol_Gridder(this.Volume, this.kerHWidth, this.interpFactor, this.extraPadding);</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="stringliteral">            this.CASVolume(:) = temp(:); % Keep the original memory pointer</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="stringliteral">            </span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="stringliteral">            if size(this.coordAxes,2) &lt; this.nStreamsFP</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="stringliteral">                error(&quot;The number of projection directions must be &gt;= the number of CUDA streams.&quot;)</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="stringliteral">            end          </span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="stringliteral">            mexMultiGPUForwardProject(this.objectHandle);            </span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="stringliteral">            </span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="stringliteral">            % Run the inverse FFT on the CAS images</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="stringliteral">            if (this.RunFFTOnGPU == false)</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="stringliteral">                this.Images(:,:,1:numAxes) = imgsFromCASImgs(this.CASImages(:,:,1:numAxes), interpBox, []); </span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="stringliteral">            end</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="stringliteral">            </span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="stringliteral">            % Consider if we forward project less number of images then we first allocated for</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="stringliteral">            ProjectionImages = this.Images(:,:,1:size(this.coordAxes,2));            </span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="stringliteral">            </span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="stringliteral">        end         </span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="stringliteral">        </span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="stringliteral">          function backProject(this, varargin)</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="stringliteral">            if ~isempty(varargin) &gt; 0</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="stringliteral">                </span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="stringliteral">                % A new set of images to back project was passed</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="stringliteral">                this.Images(:,:,1:size(varargin{1},3)) = single(varargin{1}); </span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="stringliteral">                </span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="stringliteral">                % A new set of coordinate axes to use with the back projection was passed</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="stringliteral">                numAxes = size(single(varargin{2}),2);</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="stringliteral">                this.coordAxes(:,1:numAxes) = single(varargin{2});</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="stringliteral">                mexSetVariables(&#39;</span>SetNumAxes<span class="stringliteral">&#39;, this.objectHandle, int32(numAxes));</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="stringliteral">                </span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="stringliteral">                if (this.RunFFTOnGPU == false)</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="stringliteral">                    </span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="stringliteral">                    % Run the forward FFT and convert the images to CAS images</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="stringliteral">                    [~,interpBox,~]=getSizes(single(this.VolumeSize), this.interpFactor,3);</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="stringliteral">                    this.CASImages = CASImgsFromImgs(this.Images, interpBox, []);</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="stringliteral">                    </span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="stringliteral">                end</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="stringliteral">                </span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="stringliteral">            end</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="stringliteral">            </span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="stringliteral">            mexMultiGPUBackProject(this.objectHandle);   </span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="stringliteral">            </span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="stringliteral">        end       </span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="stringliteral">    </span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="stringliteral">        %% setVolume - Set the volume</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="stringliteral">        function setVolume(this, varargin)</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="stringliteral">            % The new volume will be copied to the GPUs during this.Set()</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="stringliteral">           this.Volume = single(varargin{1}); </span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="stringliteral">        end</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="stringliteral">        %% resetVolume - Reset the volume</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="stringliteral">        function resetVolume(this)</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="stringliteral">            </span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="stringliteral">            % Multiply the volume by zero to reset. The resetted volume will be copied to the GPUs during this.Set()</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="stringliteral">           this.Volume(:) = 0;            </span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="stringliteral">           this.CASVolume(:) = 0;  % Keep the original memory pointer</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="stringliteral">        end</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="stringliteral">        %% reconstructVol - Reconstruct the volume by dividing by the plane density</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="stringliteral">        function Volume = reconstructVol(this, varargin)   </span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="stringliteral">            </span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="stringliteral">            if (this.RunFFTOnGPU == true)</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="stringliteral">                error(&quot;reconstructVol() is currently only supported if RunFFTOnGPU is set to false.&quot;)</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="stringliteral">            end</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="stringliteral">            this.Images = single(varargin{1});</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="stringliteral">            this.coordAxes = single(varargin{2});</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="stringliteral">            % Run a normal back projection first</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="stringliteral">            this.resetVolume()</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="stringliteral">            this.backProject();      </span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="stringliteral">            this.getVol();</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="stringliteral">            tmpCASVolume = this.CASVolume;</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="stringliteral">            % Now, set the CASImages to all ones and back project a second time to get the plane density array</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="stringliteral">            this.CASImages(:) = 1;</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="stringliteral">            this.resetVolume()            </span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="stringliteral">            this.backProject();     </span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="stringliteral">            this.getVol();         </span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="stringliteral">            PlaneDensity = this.CASVolume;</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="stringliteral">  </span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="stringliteral">            % Convert the CASVolume to Volume</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="stringliteral">            % Normalize by the plane density</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="stringliteral">            tmpCASVolume = tmpCASVolume ./(PlaneDensity+1e-6);</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="stringliteral">            this.Volume=volFromCAS_Gridder(tmpCASVolume,single(this.VolumeSize),this.kerHWidth, this.interpFactor);</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="stringliteral">            Volume = single(this.Volume);         </span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="stringliteral">        end   </span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="stringliteral">        %% getVol - Convert the CAS Volume to Volume</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="stringliteral">        function Volume = getVol(this)</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="stringliteral">        </span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="stringliteral">%            this.Set(); % Run the set function in case one of the arrays has changed</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="stringliteral">%            this.Set();</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="stringliteral">%            this.Set();</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="stringliteral">           </span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="stringliteral">           mexMultiGPUGetVolume(this.objectHandle);           </span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="stringliteral">           </span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="stringliteral">           % Convert the CASVolume to Volume</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="stringliteral">           this.Volume = volFromCAS_Gridder(this.CASVolume,single(this.VolumeSize),this.kerHWidth, this.interpFactor);</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="stringliteral">           Volume = single(this.Volume); </span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="stringliteral">        end</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="stringliteral">        %% CheckParameters - check that all the parameters and variables are valid</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="stringliteral">        function CheckParameters(this)</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="stringliteral">            </span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="stringliteral">            % Each x, y, and z component of the coordinate axes needs to have a norm of one</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="stringliteral">            for i = 1:size(this.coordAxes,2)</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="stringliteral">                for j = 1:3                    </span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="stringliteral">                    if norm(this.coordAxes((j-1)*3+1:j*3),2) - 1 &gt; 0.0001 % Account for rounding errors</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="stringliteral">                        warning(&quot;Invalid coordAxes parameter: Each x, y, and z component of the coordinate axes needs to have a norm of one&quot;)</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="stringliteral">                    end</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="stringliteral">                end</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="stringliteral">            end                </span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="stringliteral">            </span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="stringliteral">            if this.interpFactor &lt;= 0</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="stringliteral">                error(&quot;Invalid Interp Factor parameter: must be a non-negative value&quot;)</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="stringliteral">            end            </span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="stringliteral">            </span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="stringliteral">        end</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="stringliteral">        </span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="stringliteral">    end</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="stringliteral">end</span></div><div class="ttc" id="mex__interface_8m_html_a0a92e8b98c2f8014ac8376d6c7510de8"><div class="ttname"><a href="mex__interface_8m.html#a0a92e8b98c2f8014ac8376d6c7510de8">objectHandle</a></div><div class="ttdeci">this objectHandle</div><div class="ttdef"><b>Definition:</b> <a href="mex__interface_8m_source.html#l00020">mex_interface.m:20</a></div></div>
<div class="ttc" id="_timing_test_script_8m_html_ada8a976a34768237a2ce9b4c08e67608"><div class="ttname"><a href="_timing_test_script_8m.html#ada8a976a34768237a2ce9b4c08e67608">RunFFTOnGPU</a></div><div class="ttdeci">RunFFTOnGPU</div><div class="ttdef"><b>Definition:</b> <a href="_timing_test_script_8m_source.html#l00019">TimingTestScript.m:19</a></div></div>
<div class="ttc" id="_c_a_s_to_complex_test_8m_html_ab14ce89a06368a3ce058dbccb2ce3076"><div class="ttname"><a href="_c_a_s_to_complex_test_8m.html#ab14ce89a06368a3ce058dbccb2ce3076">CASVolume</a></div><div class="ttdeci">CASVolume</div><div class="ttdef"><b>Definition:</b> <a href="_c_a_s_to_complex_test_8m_source.html#l00007">CASToComplexTest.m:7</a></div></div>
<div class="ttc" id="_multi_gridder_timing_test_8m_html_ab5d4acec05460ab2d7535031e3ebeef0"><div class="ttname"><a href="_multi_gridder_timing_test_8m.html#ab5d4acec05460ab2d7535031e3ebeef0">nStreamsFP</a></div><div class="ttdeci">Set the number of streams gridder nStreamsFP</div><div class="ttdef"><b>Definition:</b> <a href="_multi_gridder_timing_test_8m_source.html#l00017">MultiGridderTimingTest.m:17</a></div></div>
<div class="ttc" id="get_kernel_filt_table_8m_html_a6784e1c334dfceb8f017667c0b0f6a3e"><div class="ttname"><a href="get_kernel_filt_table_8m.html#a6784e1c334dfceb8f017667c0b0f6a3e">index</a></div><div class="ttdeci">index</div><div class="ttdef"><b>Definition:</b> <a href="get_kernel_filt_table_8m_source.html#l00018">getKernelFiltTable.m:18</a></div></div>
<div class="ttc" id="get__axes__from__n__rot_8m_html_a74946d12fa08ad0e91b5f5dde42e4d5b"><div class="ttname"><a href="get__axes__from__n__rot_8m.html#a74946d12fa08ad0e91b5f5dde42e4d5b">a</a></div><div class="ttdeci">The z axis Check if the proj direction is z a</div><div class="ttdef"><b>Definition:</b> <a href="get__axes__from__n__rot_8m_source.html#l00011">get_axes_from_n_rot.m:11</a></div></div>
<div class="ttc" id="_multi_gridder_timing_test_8m_html_adf4d1866ff60e0a0d4a179ec724bc792"><div class="ttname"><a href="_multi_gridder_timing_test_8m.html#adf4d1866ff60e0a0d4a179ec724bc792">gridder</a></div><div class="ttdeci">Create the gridder object gridder</div><div class="ttdef"><b>Definition:</b> <a href="_multi_gridder_timing_test_8m_source.html#l00014">MultiGridderTimingTest.m:14</a></div></div>
<div class="ttc" id="_c_a_s_to_complex_test_8m_html_a6d9118f5c2ef537242b2308e1dad42f7"><div class="ttname"><a href="_c_a_s_to_complex_test_8m.html#a6d9118f5c2ef537242b2308e1dad42f7">Volume</a></div><div class="ttdeci">Volume</div><div class="ttdef"><b>Definition:</b> <a href="_c_a_s_to_complex_test_8m_source.html#l00005">CASToComplexTest.m:5</a></div></div>
<div class="ttc" id="_multi_gridder_timing_test_8m_html_a897b5234b10d5d8e7c453b6f5f76f884"><div class="ttname"><a href="_multi_gridder_timing_test_8m.html#a897b5234b10d5d8e7c453b6f5f76f884">images</a></div><div class="ttdeci">Initialize the memory allocation by running the forward projection once images</div><div class="ttdef"><b>Definition:</b> <a href="_multi_gridder_timing_test_8m_source.html#l00024">MultiGridderTimingTest.m:24</a></div></div>
<div class="ttc" id="get_sizes_8m_html_af5c17788289fd88c5ce8d031980f35c4"><div class="ttname"><a href="get_sizes_8m.html#af5c17788289fd88c5ce8d031980f35c4">function</a></div><div class="ttdeci">function[orig, interp, CAS]</div><div class="ttdef"><b>Definition:</b> <a href="get_sizes_8m_source.html#l00001">getSizes.m:1</a></div></div>
<div class="ttc" id="_timing_test_script_8m_html_a6f6ccfcf58b31cb6412107d9d5281426"><div class="ttname"><a href="_timing_test_script_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a></div><div class="ttdeci">for i</div><div class="ttdef"><b>Definition:</b> <a href="_timing_test_script_8m_source.html#l00021">TimingTestScript.m:21</a></div></div>
<div class="ttc" id="create__uniform__axes_8m_html_a58ab1fd68e97078232808206b850161b"><div class="ttname"><a href="create__uniform__axes_8m.html#a58ab1fd68e97078232808206b850161b">on</a></div><div class="ttdeci">hold on</div><div class="ttdef"><b>Definition:</b> <a href="create__uniform__axes_8m_source.html#l00040">create_uniform_axes.m:40</a></div></div>
<div class="ttc" id="_multi_gridder_timing_test_8m_html_a371ef7d7d88e2475119f3b6d37596903"><div class="ttname"><a href="_multi_gridder_timing_test_8m.html#a371ef7d7d88e2475119f3b6d37596903">nStreamsBP</a></div><div class="ttdeci">gridder nStreamsBP</div><div class="ttdef"><b>Definition:</b> <a href="_multi_gridder_timing_test_8m_source.html#l00018">MultiGridderTimingTest.m:18</a></div></div>
<div class="ttc" id="_matlab_example_8m_html_aa281e9bfb864b5206b9f3c2ae14cc203"><div class="ttname"><a href="_matlab_example_8m.html#aa281e9bfb864b5206b9f3c2ae14cc203">start</a></div><div class="ttdeci">clc close all clear all start</div><div class="ttdef"><b>Definition:</b> <a href="_matlab_example_8m_source.html#l00006">MatlabExample.m:6</a></div></div>
<div class="ttc" id="vol_from_c_a_s___gridder_8m_html_a624b48103a930ce475060f7d7040d128"><div class="ttname"><a href="vol_from_c_a_s___gridder_8m.html#a624b48103a930ce475060f7d7040d128">available</a></div><div class="ttdeci">function origSize of the volume and the kernel half width for precompensation Optional inputs are interpolation factor and padwidth They have default values of and resp The output is single precision interpolated and the preComp function used in precompensation Check if optional inputs are available</div><div class="ttdef"><b>Definition:</b> <a href="vol_from_c_a_s___gridder_8m_source.html#l00001">volFromCAS_Gridder.m:1</a></div></div>
<div class="ttc" id="_add_volume_test_8m_html_a48812c06132551c8490cfe6d127d1f12"><div class="ttname"><a href="_add_volume_test_8m.html#a48812c06132551c8490cfe6d127d1f12">reset</a></div><div class="ttdeci">reset(gpuDevice(GPU_Device+1))</div></div>
<div class="ttc" id="get__axes__from__n__rot_8m_html_a98431243eb755eab1bb1b077ce199d22"><div class="ttname"><a href="get__axes__from__n__rot_8m.html#a98431243eb755eab1bb1b077ce199d22">if</a></div><div class="ttdeci">if(sqrt(sum(a.*a))&lt; 0.0001)%Projection direction is z T1</div></div>
<div class="ttc" id="_timing_test_script_8m_html_a3eeac03a9d930969ad2e15361676577b"><div class="ttname"><a href="_timing_test_script_8m.html#a3eeac03a9d930969ad2e15361676577b">interpFactor</a></div><div class="ttdeci">interpFactor</div><div class="ttdef"><b>Definition:</b> <a href="_timing_test_script_8m_source.html#l00012">TimingTestScript.m:12</a></div></div>
<div class="ttc" id="grid_lib_kaiser_8m_html_afb358f48b1646c750fb9da6c6585be2b"><div class="ttname"><a href="grid_lib_kaiser_8m.html#afb358f48b1646c750fb9da6c6585be2b">end</a></div><div class="ttdeci">end</div><div class="ttdef"><b>Definition:</b> <a href="grid_lib_kaiser_8m_source.html#l00014">gridLibKaiser.m:14</a></div></div>
<div class="ttc" id="_multi_gridder_timing_test_8m_html_afeee088a42e300511137ea0a19154d47"><div class="ttname"><a href="_multi_gridder_timing_test_8m.html#afeee088a42e300511137ea0a19154d47">coordAxes</a></div><div class="ttdeci">Define the projection directions coordAxes</div><div class="ttdef"><b>Definition:</b> <a href="_multi_gridder_timing_test_8m_source.html#l00011">MultiGridderTimingTest.m:11</a></div></div>
<div class="ttc" id="class_multi_g_p_u_gridder_html"><div class="ttname"><a href="class_multi_g_p_u_gridder.html">MultiGPUGridder</a></div><div class="ttdoc">A class for gridding on multiple GPUs. </div><div class="ttdef"><b>Definition:</b> <a href="_multi_g_p_u_gridder_8h_source.html#l00029">MultiGPUGridder.h:29</a></div></div>
<div class="ttc" id="_run___unit___tests_8m_html_a0e75aa0c65fdb207c8e25c26f2d0c447"><div class="ttname"><a href="_run___unit___tests_8m.html#a0e75aa0c65fdb207c8e25c26f2d0c447">p</a></div><div class="ttdeci">clc clear close all import matlab unittest TestSuite import matlab unittest TestRunner import matlab unittest plugins TestRunProgressPlugin addpath(genpath('../Tests')) addpath(genpath('C p</div><div class="ttdef"><b>Definition:</b> <a href="_run___unit___tests_8m_source.html#l00018">Run_Unit_Tests.m:18</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Dec 2 2020 09:57:26 for Multi-GPU Gridding by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
